clc;
clear all;
close all;

%  Nout (line 10) and l (line 17) are changing in this code.

m=9; % total number of data functions
data=zeros(m,20); %data allocation

Nout=9;  %%%% data functions are changing from 1 to 9 %%%
% we choose Nout=9 (usa unemployment data) in here 

%%%%%%%%%canada%france%germany%italy%japan%russia%turkey%uk%usa%
% data= importdata('C:\Users\Dell\Desktop\G8_multi_function\data\data19\canada19.xlsx');
%%%%%%%%%%%%%%%
data=[-3.92035170304519	-3.72411312892921	-4.17055160146939	-4.55826395005275	-5.20632963402656	-5.74710958331018	-5.91143663420311	-5.09660395615760	-4.73413567100505	-2.62812485422258	-2.88154002568297	-2.92935257634156	-2.58141514040749	-2.00688725925685	-2.09852550247435	-2.23351950176976	-2.10651056625952	-1.86901391328162	-2.18175351289220	-2.24057745294490
10.6913194044121	9.70354687801701	9.12528127417529	9.03423780312036	9.63148098211220	9.98401410974582	10.6421379215205	11.4815335487045	12.4739988374908	10.9542621400586	12.3882101658780	13.6133373591048	13.6920355236915	13.6252698686445	13.5641341712248	12.4389385481237	11.9077139899094	12.1975159348969	12.2915199559729	11.7561731173036
4.12748401690885	0.998340791805987	1.74169525130476	2.86121076832380	3.79889112471300	3.51321379945210	2.85497229363445	1.87617145415626	-0.136579803249504	-2.53675706714202	2.56376656039950	1.55083550470843	2.24954585238848	1.84208107064158	2.52597344637341	3.07551464978980	1.71142677366849	2.33267939548638	2.99646435222829	2.16117651518969
19.9718051951122	18.6155986263967	17.7540659736318	17.2026001452506	17.4381560403535	17.6851335108141	17.8392452754951	17.3453997556174	15.6959529429891	14.7020269339230	14.8128529657619	15.0066008238473	16.2635250589217	17.2100217420387	17.7620563667589	18.4547982212827	18.0778234432530	18.2836923149784	18.5762602719877	18.8055262517925
23.1431335232658	22.5387379929261	21.5255010655337	21.6192204178533	22.1340179355788	22.9391388213526	23.0397939154078	22.3575671262087	21.3177682173010	18.8480630042923	18.3834665618302	18.8058790264106	19.5812283816480	19.7909791217644	20.3271907651342	20.4129709668675	20.3185255882504	20.5714029696001	20.7728938872143	20.9610362580150
14.4082542398417	13.2638696787364	13.1462043736716	13.5895170025984	14.8235152279000	15.6595715152293	16.3350450647717	16.5738404797197	17.5095378248555	13.8551891446670	15.9388113390004	17.3425506482080	17.0977078686760	16.4813813201209	16.4741144103293	15.3240702960585	14.6084179425271	14.9603137404109	15.1839613609922	14.5381296750747
3.37685727149935	2.82617111885402	1.58603162650603	2.27009497336113	2.67723669309173	3.39274684549547	3.22594410070407	2.85267248150136	3.83910029665101	-0.355546266299750	1.64004344238989	3.15684156862206	2.06933726526059	1.46483265562714	1.62222297740821	0.118627135552435	1.26158320570537	2.13011000365963	2.44258329692818	1.81221007526015
6.40000000000000	1.82000000000000	1.24000000000000	0.980000000000000	2.16000000000000	4.16000000000000	5.24000000000000	4.24000000000000	0.160000000000000	0.120000000000000	0.180000000000000	0.0700000000000000	0.160000000000000	0.0900000000000000	0.120000000000000	0.240000000000000	0.540000000000000	1.30000000000000	2.27000000000000	1.55000000000000
3.99000000000000	4.73000000000000	5.78000000000000	5.99000000000000	5.53000000000000	5.08000000000000	4.62000000000000	4.62000000000000	5.78000000000000	9.25000000000000	9.63000000000000	8.95000000000000	8.07000000000000	7.38000000000000	6.17000000000000	5.28000000000000	4.87000000000000	4.36000000000000	3.90000000000000	3.67000000000000];

l=10; % past data (l=3,5,10 in this paper)
t=l+1; 
s=length(data(1,:)) % size of each data

%%%%%%matrix creation and inversion%%%%%%%%%%
A=zeros(m*l,m*l);
C=zeros(m*l,1);
irow=0;
for i=1:m
       for j=1:l
       irow=irow+1;   
     icol=0;
    for i1=1:m
    for j1=1:l
         icol=icol+1;
         sum=0;
         for k=t:s
             sum=sum+data(i,k-j)*data(i1,k-j1);
         end
        A(irow,icol)=sum;
      end  
    end
    sum=0;
    for k=t:s
             sum=sum+data(Nout,k)*data(i,k-j);
    end
   C(irow,1)=sum;
              
    end
end

tic,B=pinv(A)*C, toc

   %%%%%%%%%%%%%%%%%%%%%%%%%%%
    alfa=zeros(m,l); %%%%%%%impact values
    count=0;
    for i=1:m
        for j=1:l
            count=count+1;
        alfa(i,j)=B(count);
         end
    end
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
w=1:1:l;
impact=zeros(l,1);
% % % % %   
%   figure

  for u=1:m

    for r=1:m % here usualy we choose the index of impact values
     %  mean=0;
for i=1:l
      impact(i)=(alfa(r,i)); % here we memorize the impact for chosen function 
 end
    end

% subplot(2,5,u)
% stem(alfa(u,1:l));
% grid on
% set(gca,'GridLineStyle',':');
% title(u)
  end
  
  toplam=0;
  ortalfa=zeros(m,1);
 for b=1:m
%  ortalfa(b,:)=0; 
  for   g=1:l
     toplam=toplam+alfa(b,g);

  end
   ortalfa(b)=toplam/l;
 end
    qq=zeros(s-t+1,1);
    count=0;
for i=t:s  
    sum=0;
for j=1:m
    for k=1:l
      sum=sum+alfa(j,k)*data(j,i-k);
    end
end
count=count+1;

qq(count)=sum;

end

%qq
% 
% figure(100);
% plot(qq,'blue'); % here we plot the output funtion in blue color
% hold on;
% grid on;
% % 
% initial_data=zeros(s-t+1,1);
% for i=1:s-t+1
%  initial_data(i) =data(Nout,l+i);  
% end
% plot(initial_data,'red'); %here we plot the initial fucntion in red color

  toplam2=zeros(m,1);
  agortalfa=zeros(m,1);
 for b=1:m
%  ortalfa(b,:)=0; 
  for   g=1:l
     toplam2(b)=toplam2(b)+alfa(b,g)*data(b,s-g);
    
   end
   agortalfa(b)=toplam2(b)/l;
 end
 
agortalfa=agortalfa'
ortalfa=ortalfa';

% xlswrite('usa_2019_impactfactor.xlsx',agortalfa, 'C89:K89')